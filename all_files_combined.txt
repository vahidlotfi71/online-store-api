===== FILE: D:\copyAllinOne\online-store-api\main.go ===== 
package main

import (
	"fmt"
	"os"

	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Routes"
	"github.com/vahidlotfi71/online-store-api/cmd"
)

func main() {
	// 1ï¸âƒ£ load env
	if err := Config.Getenv(); err != nil {
		fmt.Fprintf(os.Stderr, "Runtime Error: Could not load environment variables : %s\n", err.Error())
		os.Exit(2)
	}

	// 2ï¸âƒ£ connect DB
	if err := Config.Connect(); err != nil {
		fmt.Fprintf(os.Stderr, "Connection Error : Could not connect to the database\n%v\n", err.Error())
		os.Exit(2)
	}

	// 3ï¸âƒ£ build Fiber (Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¯Ø± Config Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª)
	app := Config.App

	// 4ï¸âƒ£ register routes
	Routes.SetupRoutes(app)

	// 5ï¸âƒ£ Ø§Ø¬Ø±Ø§ÛŒ CLI
	cmd.Execute()
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\go.mod ===== 
module github.com/vahidlotfi71/online-store-api

go 1.24.0

require (
	github.com/gofiber/fiber/v2 v2.52.9
	github.com/golang-jwt/jwt/v5 v5.3.0
	github.com/joho/godotenv v1.5.1
	github.com/spf13/cobra v1.10.1
	golang.org/x/crypto v0.14.0
	gorm.io/driver/mysql v1.6.0
	gorm.io/gorm v1.31.0
)

require (
	filippo.io/edwards25519 v1.1.0 // indirect
	github.com/andybalholm/brotli v1.1.0 // indirect
	github.com/go-sql-driver/mysql v1.8.1 // indirect
	github.com/google/uuid v1.6.0 // indirect
	github.com/inconshreveable/mousetrap v1.1.0 // indirect
	github.com/jinzhu/inflection v1.0.0 // indirect
	github.com/jinzhu/now v1.1.5 // indirect
	github.com/klauspost/compress v1.17.9 // indirect
	github.com/mattn/go-colorable v0.1.13 // indirect
	github.com/mattn/go-isatty v0.0.20 // indirect
	github.com/mattn/go-runewidth v0.0.16 // indirect
	github.com/rivo/uniseg v0.2.0 // indirect
	github.com/spf13/pflag v1.0.9 // indirect
	github.com/valyala/bytebufferpool v1.0.0 // indirect
	github.com/valyala/fasthttp v1.51.0 // indirect
	github.com/valyala/tcplisten v1.0.0 // indirect
	golang.org/x/sys v0.28.0 // indirect
	golang.org/x/text v0.20.0 // indirect
)
 
 
===== FILE: D:\copyAllinOne\online-store-api\cmd\migrate.go ===== 
package cmd

import (
	"fmt"
	"log"

	"github.com/spf13/cobra"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
	"gorm.io/gorm"
)

var force bool

func init() {
	rootCmd.AddCommand(migrateCmd)
	migrateCmd.Flags().BoolVarP(&force, "force", "f", false, "drop all tables before migrating")
}

var migrateCmd = &cobra.Command{
	Use:   "migrate",
	Short: "Create / re-create MySQL tables",
	Run: func(cmd *cobra.Command, args []string) {
		if err := Config.Getenv(); err != nil {
			log.Fatalf("env load: %v", err)
		}

		err := Config.Connect()
		if err != nil {
			log.Fatalf("db connect: %v", err)
		}

		models := []interface{}{
			&Models.User{},
			&Models.Admin{},
			&Models.Product{},
			&Models.Order{},
			&Models.OrderItem{},
		}

		if force {
			fmt.Println("ğŸ—‘ï¸  Dropping tables ...")
			for _, m := range models {
				if err := Config.DB.Migrator().DropTable(m); err != nil {
					log.Fatalf("drop: %v", err)
				}
			}
			fmt.Println("âœ… Tables dropped")
		}

		fmt.Println("ğŸ”¨ Migrating ...")
		for _, m := range models {
			if err := Config.DB.AutoMigrate(m); err != nil {
				log.Fatalf("migrate: %v", err)
			}
		}

		// seed super-admin
		seedSuperAdmin(Config.DB)
		fmt.Println("âœ… Migration & seed completed")
	},
}

func seedSuperAdmin(db *gorm.DB) {
	var admin Models.Admin
	hash, _ := Utils.GenerateHashPassword("12345678")
	db.FirstOrCreate(&admin, Models.Admin{Phone: "09123456789"},
		Models.Admin{
			FirstName:  "Super",
			LastName:   "Admin",
			Phone:      "09123456789",
			Address:    "Tehran",
			NationalID: "0000000000",
			Password:   hash,
			Role:       "admin",
			IsVerified: true,
		})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\cmd\root.go ===== 
package cmd

import (
	"github.com/spf13/cobra"
	"github.com/vahidlotfi71/online-store-api/Utils/Constants"
)

var showVersion bool

var rootCmd = &cobra.Command{
	Use:   "shop",
	Short: "Online Store API CLI",
	Long:  `CLI tools for managing the Online Store API (serve, migrate, seed, routes, etc.).`,
	Run: func(cmd *cobra.Command, args []string) {
		if showVersion {
			cmd.Printf("Application version %s\n", Constants.VERSION)
			return
		}
		cmd.Help()
	},
}

func Execute() error {
	return rootCmd.Execute()
}

func init() {
	rootCmd.Flags().BoolVarP(&showVersion, "version", "v", false, "show application version")
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\cmd\routes.go ===== 
package cmd

import (
	"fmt"
	"strings"

	"github.com/gofiber/fiber/v2"
	"github.com/spf13/cobra"
	"github.com/vahidlotfi71/online-store-api/Routes"
)

var routesCmd = &cobra.Command{
	Use:   "routes",
	Short: "Shows defined routes list",
	Long:  `Displays a clean list of all registered routes.`,
	Run: func(cmd *cobra.Command, args []string) {
		app := fiber.New()
		Routes.SetupRoutes(app)

		type routeDTO struct{ Method, Path, Name string }
		list := []routeDTO{}
		for _, r := range app.GetRoutes() {
			if r.Path == "/*" || (r.Method == "HEAD" && strings.Contains(r.Name, "index")) {
				continue
			}
			list = append(list, routeDTO{r.Method, r.Path, r.Name})
		}
		fmt.Println("Method | Path                         | Name")
		for _, r := range list {
			fmt.Printf("%-6s | %-28s | %s\n", r.Method, r.Path, r.Name)
		}
	},
}

func init() {
	rootCmd.AddCommand(routesCmd)
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\cmd\seed.go ===== 
package cmd

import (
	"fmt"
	"log"

	"github.com/spf13/cobra"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
	"gorm.io/gorm"
)

var users uint

func init() {
	rootCmd.AddCommand(seedCmd)
	seedCmd.Flags().UintVarP(&users, "users", "u", 100, "number of fake users")
}

var seedCmd = &cobra.Command{
	Use:   "seed",
	Short: "Seed database with fake users",
	Run: func(cmd *cobra.Command, args []string) {
		if err := Config.Getenv(); err != nil {
			log.Fatalf("env: %v", err)
		}
		err := Config.Connect()
		if err != nil {
			log.Fatalf("db: %v", err)
		}
		seedUsers(Config.DB, users)
		fmt.Println("âœ… seeding done")
	},
}

func seedUsers(db *gorm.DB, n uint) {
	hash, _ := Utils.GenerateHashPassword("password")
	for i := 1; i <= int(n); i++ {
		u := Models.User{
			FirstName:  fmt.Sprintf("User%d", i),
			LastName:   "Fake",
			Phone:      fmt.Sprintf("0911%07d", i),
			Address:    "Tehran",
			NationalID: fmt.Sprintf("%010d", i),
			Password:   hash,
			Role:       "user",
			IsVerified: true,
		}
		db.FirstOrCreate(&u, Models.User{Phone: u.Phone})
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\cmd\serve.go ===== 
package cmd

import (
	"log"
	"os"

	"github.com/spf13/cobra"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Routes"
)

var port string

func init() {
	rootCmd.AddCommand(serveCmd)
	serveCmd.Flags().StringVarP(&port, "port", "p", "8080", "server port")
}

var serveCmd = &cobra.Command{
	Use:   "serve",
	Short: "Start development server",
	Run: func(cmd *cobra.Command, args []string) {
		// 1) Ø®ÙˆØ§Ù†Ø¯Ù† env
		if err := Config.Getenv(); err != nil {
			log.Fatalf("env load: %v", err)
		}
		// 2) Ø§ØªØµØ§Ù„ DB
		err := Config.Connect()
		if err != nil {
			log.Fatalf("db connect: %v", err)
		}
		// 3) Ø³Ø§Ø®Øª Fiber
		app := Config.App
		// 4) Ø«Ø¨Øª Ù…Ø³ÛŒØ±Ù‡Ø§
		Routes.SetupRoutes(app)
		// 5) Ù¾ÙˆØ±Øª
		if port == "" {
			port = os.Getenv("PORT")
		}
		if port == "" {
			port = "8080"
		}
		log.Printf("ğŸš€ Server on :%s", port)
		log.Fatal(app.Listen(":" + port))
	},
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Config\App.go ===== 
package Config

import "github.com/gofiber/fiber/v2"

var App = fiber.New();
 
 
===== FILE: D:\copyAllinOne\online-store-api\Config\DBConnection.go ===== 
package Config

import (
	"fmt"

	"gorm.io/driver/mysql"
	"gorm.io/gorm"
	"gorm.io/gorm/logger"
)

var DB *gorm.DB

func Connect() error {
	connection := fmt.Sprintf("%s:%s@tcp(%s:%s)/%s?charset=%s&parseTime=True&loc=Local",
		DB_USER, DB_PASSWORD, DB_HOST, DB_PORT, DB_NAME, DB_CHARSET)

	db, err := gorm.Open(mysql.Open(connection), &gorm.Config{
		SkipDefaultTransaction: true,
		Logger:                 logger.Default.LogMode(logger.Silent),
	})

	if err != nil {
		return fmt.Errorf("config, connect : %s", err.Error())
	}
	DB = db
	return nil
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Config\EnvVars.go ===== 
package Config

import (
	"os"

	"github.com/joho/godotenv"
)

var (
	DB_HOST     string
	DB_PORT     string
	DB_USER     string
	DB_PASSWORD string
	DB_NAME     string
	DB_CHARSET  string
	JWT_SECRET  string
	SMS_API_KEY string
	SMS_SENDER  string
)

func Getenv() error {
	if err := godotenv.Load(); err != nil {
		return err
	}
	DB_HOST = os.Getenv("DB_HOST")
	DB_PORT = os.Getenv("DB_PORT")
	DB_USER = os.Getenv("DB_USER")
	DB_PASSWORD = os.Getenv("DB_PASSWORD")
	DB_NAME = os.Getenv("DB_NAME")
	DB_CHARSET = os.Getenv("DB_CHARSET")
	JWT_SECRET = os.Getenv("JWT_SECRET")
	SMS_API_KEY = os.Getenv("SMS_API_KEY")
	SMS_SENDER = os.Getenv("SMS_SENDER")

	return nil

}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\ClearTrash.go ===== 
// file: internal/Controllers/Admin/AdminController/ClearTrash.go
package AdminController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
)

func ClearTrash(c *fiber.Ctx) error {
	limitStr := c.Query("limit", "10")
	limit, _ := strconv.Atoi(limitStr)
	if limit <= 0 || limit > 50 {
		limit = 10
	}

	result := Config.DB.Unscoped().
		Where("deleted_at IS NOT NULL").
		Limit(limit).
		Delete(&Models.Admin{})

	if result.Error != nil {
		return c.Status(500).JSON(fiber.Map{"message": result.Error.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"message":       "Trash cleared successfully",
		"cleared_count": result.RowsAffected,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Delete.go ===== 
package AdminController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Admin"
	"gorm.io/gorm"
)

func Delete(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(400).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	if err := Admin.SoftDelete(Config.DB, id); err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(404).JSON(fiber.Map{"message": "Admin not found"})
		}
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{"message": "Admin moved to trash"})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Index.go ===== 
package AdminController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Admin"
	"github.com/vahidlotfi71/online-store-api/Resources/AdminResource"
)

func Index(c *fiber.Ctx) error {
	admins, meta, err := Admin.Paginate(Config.DB.Where("deleted_at IS NULL").Order("id"), c)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     AdminResource.Collection(admins),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Restore.go ===== 
package AdminController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"gorm.io/gorm"
)

func Restore(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	// Ú†Ú© ÙˆØ¬ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø­Ø°Ùâ€ŒØ´Ø¯Ù‡
	var admin Models.Admin
	if err := Config.DB.Where("deleted_at IS NOT NULL").First(&admin, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"message": "Admin not found or not in trash"})
		}
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	// Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ (NULL Ú©Ø±Ø¯Ù† deleted_at)
	if err := Config.DB.Model(&admin).Update("deleted_at", nil).Error; err != nil {
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{"message": "Admin restored successfully"})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Show.go ===== 
package AdminController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Admin"
	"github.com/vahidlotfi71/online-store-api/Resources/AdminResource"
	"gorm.io/gorm"
)

func Show(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(400).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	admin, err := Admin.FindByID(Config.DB, id)
	if err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(404).JSON(fiber.Map{"message": "Admin not found"})
		}
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{"data": AdminResource.Single(admin)})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Store.go ===== 
// file: internal/Controllers/Admin/AdminController/Store.go
package AdminController

import (
	"net/http"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Admin"
	"github.com/vahidlotfi71/online-store-api/Resources/AdminResource"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

type AdminCreateRequest struct {
	FirstName  string `json:"first_name"`
	LastName   string `json:"last_name"`
	Phone      string `json:"phone"`
	Address    string `json:"address"`
	NationalID string `json:"national_id"`
	Password   string `json:"password"`
}

func Store(c *fiber.Ctx) error {
	var req AdminCreateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	hashedPass, err := Utils.GenerateHashPassword(req.Password)
	if err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to hash password"})
	}

	dto := Admin.AdminCreateDTO{
		FirstName:  req.FirstName,
		LastName:   req.LastName,
		Phone:      req.Phone,
		Address:    req.Address,
		NationalID: req.NationalID,
		Password:   hashedPass,
	}

	admin, err := Admin.Create(tx, dto)
	if err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	return c.Status(http.StatusCreated).JSON(fiber.Map{
		"message": "Admin created successfully",
		"data":    AdminResource.Single(admin),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Trash.go ===== 
package AdminController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Admin"
	"github.com/vahidlotfi71/online-store-api/Resources/AdminResource"
)

func Trash(c *fiber.Ctx) error {
	admins, meta, err := Admin.Paginate(
		Config.DB.Where("deleted_at IS NOT NULL").Order("deleted_at ASC"),
		c,
	)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     AdminResource.Collection(admins),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AdminController\Update.go ===== 
// file: internal/Controllers/Admin/AdminController/Update.go
package AdminController

import (
	"net/http"
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Admin"
	"github.com/vahidlotfi71/online-store-api/Resources/AdminResource"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

type AdminUpdateRequest struct {
	FirstName  string `json:"first_name"`
	LastName   string `json:"last_name"`
	Phone      string `json:"phone"`
	Address    string `json:"address"`
	NationalID string `json:"national_id"`
	Password   string `json:"password"` // optional
}

func Update(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(400).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	var req AdminUpdateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	if req.Password != "" {
		hashedPass, err := Utils.GenerateHashPassword(req.Password)
		if err != nil {
			tx.Rollback()
			return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to hash password"})
		}
		req.Password = hashedPass
	}

	dto := Admin.AdminUpdateDTO{
		FirstName:  req.FirstName,
		LastName:   req.LastName,
		Phone:      req.Phone,
		Address:    req.Address,
		NationalID: req.NationalID,
		Password:   req.Password,
	}

	if err := Admin.Update(tx, id, dto); err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	// Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø´ØªÙ† struct Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒØ´Ø¯Ù‡
	updatedAdmin, err := Admin.FindByID(tx, id)
	if err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	return c.Status(http.StatusOK).JSON(fiber.Map{
		"message": "Admin updated successfully",
		"data":    AdminResource.Single(updatedAdmin),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AuthController\AdminLogin.go ===== 
package AuthController

import (
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

type adminLoginResp struct {
	Token      string    `json:"token"`
	ExpireTime time.Time `json:"expire_time"`
}

type adminLoginReq struct {
	Phone      string `json:"phone"`
	Password   string `json:"password"`
	RememberMe bool   `json:"remember_me"`
}

func AdminLogin(c *fiber.Ctx) error {
	var body adminLoginReq
	if err := c.BodyParser(&body); err != nil {
		return c.Status(400).JSON(fiber.Map{"message": "Invalid input"})
	}

	if body.Phone == "" {
		return c.Status(422).JSON(fiber.Map{"message": "Phone is required"})
	}

	db := Config.DB
	var admin Models.Admin

	// ÙÙ‚Ø· Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø¬Ø³ØªØ¬Ùˆ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
	db.Where("deleted_at IS NULL").Where("phone = ?", body.Phone).First(&admin)

	if admin.ID == 0 {
		return c.Status(404).JSON(fiber.Map{"message": "Admin not found"})
	}

	if err := Utils.VerifyPassword(body.Password, admin.Password); err != nil {
		return c.Status(401).JSON(fiber.Map{"message": "Wrong credentials"})
	}

	token, expire, err := Utils.CreateToken(
		admin.ID,
		admin.Role,
		admin.FirstName+" "+admin.LastName,
		admin.Phone,
		body.RememberMe,
	)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": "Failed to generate token"})
	}

	return c.Status(200).JSON(adminLoginResp{
		Token:      token,
		ExpireTime: expire,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AuthController\AdminLogout.go ===== 
package AuthController

import "github.com/gofiber/fiber/v2"

func AdminLogout(c *fiber.Ctx) error {
	// Ø§Ú¯Ø± Ø³Ø´Ù† ÛŒØ§ ØªÙˆÚ©Ù† Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù‡â€Œ Ø§ÛŒÙ…ØŒ Ø¢Ù† Ø±Ø§ Ø­Ø°Ù Ù…ÛŒÚ©Ù†ÛŒÙ…
	// Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…Ø«Ø§Ù„:
	// c.ClearCookie("admin_session")
	// ÛŒØ§ Ø§Ú¯Ø± Ø§Ø² JWT Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒÚ©Ù†ÛŒÙ… ØªÙˆÚ©Ù† Ø±Ø§ Ø¯Ø± Ø³Ù…Øª Ú©Ù„Ø§ÛŒÙ†Øª Ø­Ø°Ù Ù…ÛŒÚ©Ù†ÛŒÙ…

	return c.Status(200).JSON(fiber.Map{
		"message": "You have been logged out",
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AuthController\Login.go ===== 
package AuthController

import (
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

/* ----------  Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø§Ø³Ø®  ---------- */
type loginResp struct {
	Token      string    `json:"token"`
	ExpireTime time.Time `json:"expire_time"`
}

/* ----------  Ø³Ø§Ø®ØªØ§Ø± ÙˆØ±ÙˆØ¯ÛŒ  ---------- */
type loginReq struct {
	Phone      string `json:"phone"`
	Password   string `json:"password"`
	RememberMe bool   `json:"remember_me"`
}

/* ----------  ØªØ§Ø¨Ø¹ Ù„Ø§Ú¯ÛŒÙ†  ---------- */
func Login(c *fiber.Ctx) error {
	var body loginReq
	if err := c.BodyParser(&body); err != nil {
		return c.Status(400).JSON(fiber.Map{"message": "Invalid input"})
	}

	if body.Phone == "" {
		return c.Status(422).JSON(fiber.Map{"message": "Phone is required"})
	}

	db := Config.DB
	var user Models.User

	// ÙÙ‚Ø· Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø¬Ø³ØªØ¬Ùˆ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
	db.Where("deleted_at IS NULL").Where("phone = ?", body.Phone).First(&user)

	if user.ID == 0 {
		return c.Status(404).JSON(fiber.Map{"message": "User not found"})
	}

	if err := Utils.VerifyPassword(body.Password, user.Password); err != nil {
		return c.Status(401).JSON(fiber.Map{"message": "Wrong credentials"})
	}

	/* ----  ØªÙˆÙ„ÛŒØ¯ JWT ---- */
	token, expire, err := Utils.CreateToken(
		user.ID,
		user.Role,
		user.FirstName+" "+user.LastName,
		user.Phone,
		body.RememberMe,
	)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": "Failed to generate token"})
	}

	/* ----  Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚  ---- */
	return c.Status(200).JSON(loginResp{
		Token:      token,
		ExpireTime: expire,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\AuthController\Register.go ===== 
package AuthController

import (
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

type RegisterResponse struct {
	Token      string      `json:"token"`
	ExpireTime time.Time   `json:"expire_time"`
	User       Models.User `json:"user"`
}

// Register Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
func Register(c *fiber.Ctx) error {
	// Ø´Ø±ÙˆØ¹ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø¯ÛŒØªØ§Ø¨ÛŒØ³Ø› Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ ÛµÛ°Û° Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯
	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(500).JSON(fiber.Map{"message": "Database connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	// 2) ØªØ¹Ø±ÛŒÙ Ø³Ø§Ø®ØªØ§Ø± ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ù¾Ø§Ø±Ø³ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø¯ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
	var input struct {
		FirstName  string `json:"first_name"`
		LastName   string `json:"last_name"`
		Phone      string `json:"phone"`
		Address    string `json:"address"`
		NationalID string `json:"national_ID"`
		Password   string `json:"password"`
		RememberMe bool   `json:"remember_me"`
	}
	if err := c.BodyParser(&input); err != nil {
		tx.Rollback()
		return c.Status(400).JSON(fiber.Map{"message": "Invalid input data"})
	}

	// Ù‡Ø´ Ú©Ø±Ø¯Ù† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
	hashedPass, err := Utils.GenerateHashPassword(input.Password)
	if err != nil {
		tx.Rollback()
		return c.Status(500).JSON(fiber.Map{"message": "Ø®Ø·Ø§ Ø¯Ø± Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"})
	}

	//  Ø³Ø§Ø®Øª Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø¯Ø±Ø¬ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ users
	now := time.Now()
	user := Models.User{
		FirstName:  input.FirstName,
		LastName:   input.LastName,
		Phone:      input.Phone,
		Address:    input.Address,
		NationalID: input.NationalID,
		Password:   hashedPass,
		Role:       "user",
		IsVerified: false,
		CreateAt:   now,
		UpdateAt:   now,
	}
	if err := tx.Create(&user).Error; err != nil {
		tx.Rollback()
		return c.Status(500).JSON(fiber.Map{"message": "Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ú©Ø§Ø±Ø¨Ø±"})
	}

	// ØªÙˆÙ„ÛŒØ¯ JWT Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
	token, expireTime, err := Utils.CreateToken(
		user.ID,
		user.Role,
		user.FirstName+" "+user.LastName,
		user.Phone,
		input.RememberMe,
	)
	if err != nil {
		tx.Rollback()
		return c.Status(500).JSON(fiber.Map{"message": "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù†"})
	}

	//Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ ØªØ±Ø§Ú©Ù†Ø´
	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(500).JSON(fiber.Map{"message": "Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªØ±Ø§Ú©Ù†Ø´"})
	}

	// Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚ÛŒØª
	return c.Status(200).JSON(RegisterResponse{
		Token:      token,
		ExpireTime: expireTime,
		User:       user,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\OrderController\Index.go ===== 
package OrderController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Order"
	"github.com/vahidlotfi71/online-store-api/Resources/OrderResource"
)

func Index(c *fiber.Ctx) error {
	orders, meta, err := Order.Paginate(Config.DB.Where("deleted_at IS NULL").Order("id"), c)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     OrderResource.Collection(orders),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\OrderController\Order.go ===== 
package OrderController

import (
	"net/http"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/OrderResource"
)

type OrderCreateRequest struct {
	Items []OrderItemRequest `json:"items"`
}

type OrderItemRequest struct {
	ProductID uint `json:"product_id"`
	Quantity  int  `json:"quantity"`
}

func Store(c *fiber.Ctx) error {
	var req OrderCreateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	// Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
	if len(req.Items) == 0 {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Order must have at least one item"})
	}

	user := c.Locals("user").(Models.User)

	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
	totalPrice := 0.0
	var orderItems []Models.OrderItem

	for _, item := range req.Items {
		var product Models.Product
		if err := tx.Where("deleted_at IS NULL AND is_active = true").First(&product, item.ProductID).Error; err != nil {
			tx.Rollback()
			return c.Status(http.StatusNotFound).JSON(fiber.Map{"message": "Product not found"})
		}

		if product.Stock < item.Quantity {
			tx.Rollback()
			return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Insufficient stock for product: " + product.Name})
		}

		if item.Quantity <= 0 {
			tx.Rollback()
			return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Quantity must be greater than zero"})
		}

		itemTotal := product.Price * float64(item.Quantity)
		totalPrice += itemTotal

		orderItems = append(orderItems, Models.OrderItem{
			ProductID: item.ProductID,
			Quantity:  item.Quantity,
			Price:     product.Price,
		})

		// Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
		product.Stock -= item.Quantity
		if err := tx.Save(&product).Error; err != nil {
			tx.Rollback()
			return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to update product stock"})
		}
	}

	// Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´
	order := Models.Order{
		UserID:     user.ID,
		Status:     Models.StatusPending,
		TotalPrice: totalPrice,
		Items:      orderItems,
		CreateAt:   time.Now(),
		UpdateAt:   time.Now(),
	}

	if err := tx.Create(&order).Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to create order"})
	}

	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø´Ø§Ù…Ù„ Ø´Ø¯Ù† Ø±ÙˆØ§Ø¨Ø·
	var createdOrder Models.Order
	if err := Config.DB.Preload("Items.Product").First(&createdOrder, order.ID).Error; err != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to load order details"})
	}

	return c.Status(http.StatusCreated).JSON(fiber.Map{
		"message": "Order created successfully",
		"data":    OrderResource.Single(createdOrder),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\OrderController\Show.go ===== 
package OrderController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/OrderResource"
	"gorm.io/gorm"
)

func Show(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id must be a positive integer"})
	}
	id := uint(num)

	var order Models.Order
	if err := Config.DB.Where("deleted_at IS NULL").Preload("Items.Product").First(&order, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"message": "Order not found"})
		}
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{"data": OrderResource.Single(order)})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\OrderController\Trash.go ===== 
package OrderController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Order"
	"github.com/vahidlotfi71/online-store-api/Resources/OrderResource"
)

func Trash(c *fiber.Ctx) error {
	order, meta, err := Order.Paginate(
		Config.DB.Where("deleted_at IS NOT NULL").Order("id"),
		c,
	)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     OrderResource.Collection(order),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\OrderController\Update.go ===== 
package OrderController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/OrderResource"
	"gorm.io/gorm"
)

type OrderUpdateRequest struct {
	Status *string `json:"status"`
}

func Update(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	var req OrderUpdateRequest
	if err := c.BodyParser(&req); err != nil || req.Status == nil {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	var order Models.Order
	if err := Config.DB.Where("deleted_at IS NULL").First(&order, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"message": "Order not found"})
		}
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := Config.DB.Model(&order).Update("status", *req.Status).Error; err != nil {
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"message": "Order status updated",
		"data":    OrderResource.Single(order),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\ClearTrash.go ===== 
package ProductController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
)

func ClearTrash(c *fiber.Ctx) error {
	limitStr := c.Query("limit", "10")
	limit, _ := strconv.Atoi(limitStr)
	if limit <= 0 || limit > 50 {
		limit = 10
	}

	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	var products []Models.Product
	if err := tx.Unscoped().Where("deleted_at IS NOT NULL").Limit(limit).Find(&products).Error; err != nil {
		tx.Rollback()
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	result := tx.Unscoped().Delete(&Models.Product{}, "deleted_at IS NOT NULL AND id IN (?)",
		tx.Model(&Models.Product{}).Select("id").Where("deleted_at IS NOT NULL").Limit(limit))
	if result.Error != nil {
		tx.Rollback()
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": result.Error.Error()})
	}

	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"message":       "Trash cleared successfully",
		"cleared_count": result.RowsAffected,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Delete.go ===== 
package ProductController

import (
	"strconv"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"gorm.io/gorm"
)

func Delete(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	var product Models.Product
	if err := Config.DB.Where("deleted_at IS NULL").First(&product, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"message": "Product not found"})
		}
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := Config.DB.Model(&product).Update("deleted_at", time.Now()).Error; err != nil {
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{"message": "Product deleted successfully"})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Index.go ===== 
package ProductController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/ProductResource"
	"github.com/vahidlotfi71/online-store-api/Utils/Http"
)

func Index(c *fiber.Ctx) error {
	var products []Models.Product
	tx := Config.DB.Table("products").Where("deleted_at IS NULL")
	tx.Order("id")

	var metadata Http.PaginationMetadata
	tx, metadata = Http.Paginate(tx, c)
	tx.Find(&products)

	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"data":     ProductResource.Collection(products),
		"metadata": metadata,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Restore.go ===== 
package ProductController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"gorm.io/gorm"
)

func Restore(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	var product Models.Product
	if err := Config.DB.Where("deleted_at IS NOT NULL").First(&product, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"message": "Product not found or not deleted"})
		}
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := Config.DB.Model(&product).Update("deleted_at", nil).Error; err != nil {
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{"message": "Product restored successfully"})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Show.go ===== 
package ProductController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/ProductResource"
	"gorm.io/gorm"
)

func Show(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"message": "id must be a positive integer"})
	}
	id := uint(num)

	var product Models.Product
	if err := Config.DB.Where("deleted_at IS NULL").First(&product, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"message": "Product not found"})
		}
		return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(fiber.StatusOK).JSON(fiber.Map{"data": ProductResource.Single(product)})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Store.go ===== 
package ProductController

import (
	"net/http"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Product"
	"github.com/vahidlotfi71/online-store-api/Resources/ProductResource"
)

type ProductCreateRequest struct {
	Name        string  `json:"name"`
	Brand       string  `json:"brand"`
	Price       float64 `json:"price"`
	Description string  `json:"description"`
	Stock       int     `json:"stock"`
	IsActive    bool    `json:"is_active"`
}

func Store(c *fiber.Ctx) error {
	var req ProductCreateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	dto := Product.ProductCreateDTO{
		Name:        req.Name,
		Brand:       req.Brand,
		Price:       req.Price,
		Description: req.Description,
		Stock:       req.Stock,
		IsActive:    req.IsActive,
	}

	product, err := Product.Create(tx, dto)
	if err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	return c.Status(http.StatusCreated).JSON(fiber.Map{
		"message": "Product created successfully",
		"data":    ProductResource.Single(product),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Trash.go ===== 
package ProductController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/Product"
	"github.com/vahidlotfi71/online-store-api/Resources/ProductResource"
)

func Trash(c *fiber.Ctx) error {
	product, meta, err := Product.Paginate(
		Config.DB.Where("deleted_at IS NOT NULL").Order("id"),
		c,
	)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     ProductResource.Collection(product),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\ProductController\Update.go ===== 
package ProductController

import (
	"net/http"
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Models/Product"
	"github.com/vahidlotfi71/online-store-api/Resources/ProductResource"
	"gorm.io/gorm"
)

type ProductUpdateRequest struct {
	Name        string  `json:"name"`
	Brand       string  `json:"brand"`
	Price       float64 `json:"price"`
	Description string  `json:"description"`
	Stock       int     `json:"stock"`
	IsActive    bool    `json:"is_active"`
}

func Update(c *fiber.Ctx) error {
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, _ := strconv.ParseUint(idStr, 10, 32)
	id := uint(num)

	var req ProductUpdateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	var product Models.Product
	if err := tx.Where("deleted_at IS NULL").First(&product, id).Error; err != nil {
		tx.Rollback()
		if err == gorm.ErrRecordNotFound {
			return c.Status(http.StatusNotFound).JSON(fiber.Map{"message": "Product not found"})
		}
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	dto := Product.ProductUpdateDTO{
		Name:        req.Name,
		Brand:       req.Brand,
		Price:       req.Price,
		Description: req.Description,
		Stock:       req.Stock,
		IsActive:    req.IsActive,
	}

	if err := Product.Update(tx, id, dto); err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	return c.Status(http.StatusOK).JSON(fiber.Map{
		"message": "Product updated successfully",
		"data":    ProductResource.Single(product),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\ClearTrash.go ===== 
// file: Controllers/UserController.go
package UserController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
)

// ClearTrash Ø­Ø°Ù ÙÛŒØ²ÛŒÚ©ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø­Ø°Ùâ€ŒØ´Ø¯Ù‡ (Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±)
func ClearTrash(c *fiber.Ctx) error {
	// Û±) Ø®ÙˆØ§Ù†Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ (Ø¨Ø§ Ø³Ù‚Ù Ø§Ù…Ù†)
	limitStr := c.Query("limit", "10")
	limit, err := strconv.Atoi(limitStr)
	if err != nil || limit <= 0 || limit > 50 {
		limit = 10
	}

	// Û²) Ø´Ø±ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´
	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	// Û³) Ø®ÙˆØ§Ù†Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø­Ø°Ùâ€ŒØ´Ø¯Ù‡
	var users []Models.User
	if err := tx.Unscoped().
		Where("deleted_at IS NOT NULL").
		Order("deleted_at ASC").
		Limit(limit).
		Find(&users).Error; err != nil {
		tx.Rollback()
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": err.Error()})
	}

	// Û´) Ø­Ø°Ù ÙÛŒØ²ÛŒÚ©ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ
	result := tx.Unscoped().Delete(&Models.User{}, "deleted_at IS NOT NULL AND id IN (?)",
		tx.Model(&Models.User{}).Select("id").Where("deleted_at IS NOT NULL").Limit(limit))
	if result.Error != nil {
		tx.Rollback()
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": result.Error.Error()})
	}

	// Ûµ) Ú©Ø§Ù…ÛŒØª Ù…ÙˆÙÙ‚
	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": "Commit failed"})
	}

	// Û¶) Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚
	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"message":       "Trash cleared successfully",
		"cleared_count": result.RowsAffected,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Delete.go ===== 
// file: Controllers/UserController.go
package UserController

import (
	"strconv"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"gorm.io/gorm"
)

// Delete Ø§Ù†Ø¬Ø§Ù… Soft-Delete Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù†Ø§Ø³Ù‡
func Delete(c *fiber.Ctx) error {
	// Û±) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù†Ø§Ø³Ù‡
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).
			JSON(fiber.Map{"message": "id param is required"})
	}
	num, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		return c.Status(fiber.StatusBadRequest).
			JSON(fiber.Map{"message": "id must be a positive integer"})
	}
	id := uint(num)

	// Û²) Ú†Ú© ÙˆØ¬ÙˆØ¯ Ø±Ú©ÙˆØ±Ø¯ (ÙÙ‚Ø· Ø­Ø°Ùâ€ŒÙ†Ø´Ø¯Ù‡â€ŒÙ‡Ø§)
	var user Models.User
	if err := Config.DB.Where("deleted_at IS NULL").First(&user, id).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).
				JSON(fiber.Map{"message": "User not found"})
		}
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": err.Error()})
	}

	// Û³) Soft-Delete Ø¨Ø§ ORM + RowsAffected
	result := Config.DB.Model(&Models.User{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Update("deleted_at", time.Now())

	if result.Error != nil {
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": result.Error.Error()})
	}
	if result.RowsAffected == 0 {
		return c.Status(fiber.StatusNotFound).
			JSON(fiber.Map{"message": "User not found"})
	}

	// Û´) Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚
	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"message": "User deleted successfully",
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Index.go ===== 
package UserController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/User"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
)

func Index(c *fiber.Ctx) error {
	users, meta, err := User.Paginate(Config.DB.Where("deleted_at IS NULL").Order("id"), c)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     UserResource.Collection(users),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Restore.go ===== 
// file: Controllers/UserController.go
package UserController

import (
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
	"gorm.io/gorm"
)

// Restore Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù†Ø±Ù… (Soft-Delete) Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù†Ø§Ø³Ù‡
func Restore(c *fiber.Ctx) error {
	// Û±) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù†Ø§Ø³Ù‡
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).
			JSON(fiber.Map{"message": "id param is required"})
	}
	num, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		return c.Status(fiber.StatusBadRequest).
			JSON(fiber.Map{"message": "id must be a positive integer"})
	}
	id := uint(num)

	// Û²) Ú†Ú© ÙˆØ¬ÙˆØ¯ Ø±Ú©ÙˆØ±Ø¯ Ø­Ø°Ùâ€ŒØ´Ø¯Ù‡
	var user Models.User
	if err := Config.DB.
		Where("id = ? AND deleted_at IS NOT NULL", id).
		First(&user).Error; err != nil {
		if err == gorm.ErrRecordNotFound {
			return c.Status(fiber.StatusNotFound).
				JSON(fiber.Map{"message": "User not found or not deleted"})
		}
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": err.Error()})
	}

	// Û³) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø¨Ø§ ORM + RowsAffected
	result := Config.DB.
		Model(&Models.User{}).
		Where("id = ? AND deleted_at IS NOT NULL", id).
		Update("deleted_at", gorm.Expr("NULL"))

	if result.Error != nil {
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": result.Error.Error()})
	}
	if result.RowsAffected == 0 {
		return c.Status(fiber.StatusNotFound).
			JSON(fiber.Map{"message": "User not found or not deleted"})
	}

	// Û´) Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…Ø¯Ù„ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®
	if err := Config.DB.First(&user, id).Error; err != nil {
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": err.Error()})
	}

	// Ûµ) Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚
	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"message": "User restored successfully",
		"data":    UserResource.Single(user),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Show.go ===== 
package UserController

import (
	"errors"
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
	"gorm.io/gorm"
)

// Show Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù†Ø§Ø³Ù‡
func Show(c *fiber.Ctx) error {
	// Û±) Ø®ÙˆØ§Ù†Ø¯Ù† Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù†Ø§Ø³Ù‡ Ø§Ø² Ù…Ø³ÛŒØ±
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(fiber.StatusBadRequest).
			JSON(fiber.Map{"message": "id param is required"})
	}
	num, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		return c.Status(fiber.StatusBadRequest).
			JSON(fiber.Map{"message": "id must be a positive integer"})
	}
	id := uint(num)

	// Û²) Ø¬Ø³ØªØ¬ÙˆÛŒ Ø±Ú©ÙˆØ±Ø¯ (ÙÙ‚Ø· Ø­Ø°Ùâ€ŒÙ†Ø´Ø¯Ù‡â€ŒÙ‡Ø§)
	var user Models.User
	if dbErr := Config.DB.Where("deleted_at IS NULL").First(&user, id).Error; dbErr != nil {
		if errors.Is(dbErr, gorm.ErrRecordNotFound) {
			return c.Status(fiber.StatusNotFound).
				JSON(fiber.Map{"message": "User not found"})
		}
		return c.Status(fiber.StatusInternalServerError).
			JSON(fiber.Map{"message": dbErr.Error()})
	}

	// Û³) Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚
	return c.Status(fiber.StatusOK).JSON(fiber.Map{
		"data": UserResource.Single(user),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Store.go ===== 
// file: Controllers/UserController.go
package UserController

import (
	"net/http"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/User"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

/* ---------- DTO (ÙÙ‚Ø· Ø³Ø§Ø®ØªØ§Ø±ØŒ) ---------- */
type UserCreateRequest struct {
	FirstName  string `json:"first_name"`
	LastName   string `json:"last_name"`
	Phone      string `json:"phone"`
	Address    string `json:"address"`
	NationalID string `json:"national_id"`
	Password   string `json:"password"`
}

// Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø¨Ø±
func Store(c *fiber.Ctx) error {
	// Û±) Parsing JSON
	var req UserCreateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	// Û²) Ø´Ø±ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´
	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	// Û³) Ù‡Ø´ Ù¾Ø³ÙˆØ±Ø¯
	hashedPass, err := Utils.GenerateHashPassword(req.Password)
	if err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to hash password"})
	}

	// Û´) Ø³Ø§Ø®Øª DTO Ø¨Ø±Ø§ÛŒ Repository
	dto := User.UserCreateDTO{
		FirstName:  req.FirstName,
		LastName:   req.LastName,
		Phone:      req.Phone,
		Address:    req.Address,
		NationalID: req.NationalID,
		Password:   hashedPass,
	}

	// Ûµ) Ø¯Ø±Ø¬ Ø¯Ø± DB
	user, err := User.Create(tx, dto)
	if err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	// Û¶) Ú©Ø§Ù…ÛŒØª Ù…ÙˆÙÙ‚
	if err = tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	// Û·) Ù¾Ø§Ø³Ø® Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
	return c.Status(http.StatusCreated).JSON(fiber.Map{
		"message": "User created successfully",
		"data":    UserResource.Single(user),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Trash.go ===== 
package UserController

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models/User"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
)

func Trash(c *fiber.Ctx) error {
	users, meta, err := User.Paginate(
		Config.DB.Where("deleted_at IS NOT NULL").Order("id"),
		c,
	)
	if err != nil {
		return c.Status(500).JSON(fiber.Map{"message": err.Error()})
	}

	return c.Status(200).JSON(fiber.Map{
		"data":     UserResource.Collection(users),
		"metadata": meta,
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Controllers\UserController\Update.go ===== 
// file: Controllers/UserController.go
package UserController

import (
	"net/http"
	"strconv"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Models/User"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
	"github.com/vahidlotfi71/online-store-api/Utils"
	"gorm.io/gorm"
)

/* ---------- DTO ---------- */
type UserUpdateRequest struct {
	FirstName  string `json:"first_name"`
	LastName   string `json:"last_name"`
	Phone      string `json:"phone"`
	Address    string `json:"address"`
	NationalID string `json:"national_id"`
	Password   string `json:"password"` // Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
}

/* ---------- ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø¯ÙˆÙ† Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„) ---------- */
func Update(c *fiber.Ctx) error {
	// Û±) Ø´Ù†Ø§Ø³Ù‡ Ø§Ø² Ù…Ø³ÛŒØ±
	idStr := c.Params("id")
	if idStr == "" {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "id param is required"})
	}
	num, err := strconv.ParseUint(idStr, 10, 32)
	if err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "id must be a positive integer"})
	}
	id := uint(num)

	// Û²) Parsing JSON
	var req UserUpdateRequest
	if err := c.BodyParser(&req); err != nil {
		return c.Status(http.StatusBadRequest).JSON(fiber.Map{"message": "Invalid JSON"})
	}

	// Û³) Ø´Ø±ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´
	tx := Config.DB.Begin()
	if tx.Error != nil {
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "DB connection error"})
	}
	defer func() {
		if r := recover(); r != nil {
			tx.Rollback()
		}
	}()

	// Û´) Ú†Ú© ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± (Ø­Ø°Ùâ€ŒÙ†Ø´Ø¯Ù‡)
	var user Models.User
	if err := tx.Where("deleted_at IS NULL").First(&user, id).Error; err != nil {
		tx.Rollback()
		if err == gorm.ErrRecordNotFound {
			return c.Status(http.StatusNotFound).JSON(fiber.Map{"message": "User not found"})
		}
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	// Ûµ) Ù‡Ø´ Ù¾Ø³ÙˆØ±Ø¯ (Ø¯Ø± ØµÙˆØ±Øª Ø§Ø±Ø³Ø§Ù„)
	if req.Password != "" {
		req.Password, err = Utils.GenerateHashPassword(req.Password)
		if err != nil {
			tx.Rollback()
			return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Failed to hash password"})
		}
	}

	// Û¶) Ø³Ø§Ø®Øª DTO Ø¨Ø±Ø§ÛŒ Repository
	dto := User.UserUpdateDTO{
		FirstName:  req.FirstName,
		LastName:   req.LastName,
		Phone:      req.Phone,
		Address:    req.Address,
		NationalID: req.NationalID,
		Password:   req.Password, // ØªØµÙˆÛŒØ± Ù†Ø¯Ø§Ø±ÛŒÙ…
	}

	// Û·) Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± DB
	if err := User.Update(tx, id, dto); err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": err.Error()})
	}

	// Û¸) Ú©Ø§Ù…ÛŒØª Ù…ÙˆÙÙ‚
	if err := tx.Commit().Error; err != nil {
		tx.Rollback()
		return c.Status(http.StatusInternalServerError).JSON(fiber.Map{"message": "Commit failed"})
	}

	// Û¹) Ù¾Ø§Ø³Ø® Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ (Ø¨Ø§ Ù…Ø¯Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒØ´Ø¯Ù‡)
	return c.Status(http.StatusOK).JSON(fiber.Map{
		"message": "User updated successfully",
		"data":    UserResource.Single(user),
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Middlewares\AdminAuthMiddleware.go ===== 
package Middlewares

import (
	"strings"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

func AdminAuthMiddleware(c *fiber.Ctx) error {
	token := c.Get("Authorization")

	if token == "" {
		return c.Status(401).JSON(fiber.Map{
			"message": "Unauthorized",
		})
	}

	tokenSplit := strings.Split(token, " ")

	if len(tokenSplit) != 2 || strings.ToLower(tokenSplit[0]) != "bearer" {
		return c.Status(400).JSON(fiber.Map{
			"message": "Invalid token type, expected bearer",
		})
	}

	claims, err := Utils.VerifyToken(tokenSplit[1])
	if err != nil {
		return c.Status(400).JSON(fiber.Map{
			"message": "Invalid token",
		})
	}

	// Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù‚Ø´ Ø§Ø¯Ù…ÛŒÙ†
	if claims.Role != "admin" {
		return c.Status(403).JSON(fiber.Map{
			"message": "Access denied. Admin role required",
		})
	}

	var admin Models.Admin
	if err := Config.DB.First(&admin, claims.ID).Error; err != nil {
		return c.Status(401).JSON(fiber.Map{"message": "Admin not found"})
	}

	c.Locals("admin", admin)
	return c.Next()
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Middlewares\AuthMiddleware.go ===== 
package Middlewares

import (
	"strings"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Config"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils"
)

func UserAuthMiddleware(c *fiber.Ctx) error {
	token := c.Get("Authorization")

	if token == "" {
		return c.Status(401).JSON(fiber.Map{
			"message": "Unauthorized",
		})
	}

	tokenSplit := strings.Split(token, " ")

	if len(tokenSplit) != 2 || strings.ToLower(tokenSplit[0]) != "bearer" {
		return c.Status(400).JSON(fiber.Map{
			"message": "Invalid token type, expected bearer",
		})
	}

	claims, err := Utils.VerifyToken(tokenSplit[1])
	if err != nil {
		return c.Status(400).JSON(fiber.Map{
			"message": "Invalid token",
		})
	}

	// Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
	if claims.Role != "user" {
		return c.Status(403).JSON(fiber.Map{
			"message": "Access denied. User role required",
		})
	}

	var user Models.User
	if err := Config.DB.First(&user, claims.ID).Error; err != nil {
		return c.Status(401).JSON(fiber.Map{"message": "User not found"})
	}

	c.Locals("user", user)
	return c.Next()
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Middlewares\ValidationMiddleware.go ===== 
package Middlewares

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Providers"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func ValidationMiddleware(schema []Rules.FieldRules) func(c *fiber.Ctx) error {
	return func(c *fiber.Ctx) error {

		body := c.Request().Body()
		if len(body) == 0 {
			return c.Status(400).JSON(fiber.Map{
				"message": "Empty form-data request",
			})
		}

		for _, field_rules := range schema {
			for _, rule := range field_rules.Rules {
				passed, message, flags, err := rule(c, field_rules.FieldName)
				if err != nil {
					return c.Status(500).JSON(fiber.Map{
						"message": Providers.ErrorProvider(err),
					})
				}

				if passed && (flags != nil && flags.IsNull) {
					break
				} else if !passed {
					return c.Status(400).JSON(fiber.Map{
						"message": message,
					})
				}
			}
		}
		return c.Next()
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\Admin.go ===== 
package Models

import "time"

type Admin struct {
	ID         uint       `json:"id" gorm:"primaryKey"`
	FirstName  string     `json:"first_name" gorm:"not null"`
	LastName   string     `json:"last_name" gorm:"not null"`
	Phone      string     `json:"phone" gorm:"unique;not null"`
	Address    string     `json:"address" gorm:"not null"`
	NationalID string     `json:"national_ID" gorm:"unique;not null"`
	Password   string     `json:"-" gorm:"not null"`
	Role       string     `json:"-" gorm:"not null;default:admin"` // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ admin
	IsVerified bool       `json:"is_verified" gorm:"default:false"`
	VerifyCode string     `json:"-"  gorm:"size:6"`
	CreateAt   time.Time  `json:"created_at"`
	UpdateAt   time.Time  `json:"updated_at"`
	Deleted_at *time.Time `json:"deleted_at"`
}

func (Admin) TableName() string { return "admin" }
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\Order.go ===== 
package Models

import "time"

type OrderStatus string

const (
	StatusPending   OrderStatus = "pending"
	StatusPaid      OrderStatus = "paid"
	StatusCancelled OrderStatus = "cancelled"
)

type Order struct {
	ID         uint        `gorm:"PrimaryKey" json:"id"`
	UserID     uint        `gorm:"not null" json:"user-id"`
	Status     OrderStatus `gorm:"default:pending" json:"status"`
	TotalPrice float64     `gorm:"not null" json:"total_price"` //ØªÙˆÙ…Ø§Ù†
	Items      []OrderItem `gorm:"foreignKey:OrderID" json:"items"`
	CreateAt   time.Time   `json:"created_at"`
	UpdateAt   time.Time   `json:"updated_at"`
	Deleted_at *time.Time  `json:"deleted_at"`
	//Relation
	User User `gorm:"foreignKey:UserID" json:"user,omitempty"`
}

type OrderItem struct {
	ID        uint    `gorm:"primaryKey" json:"id"`
	OrderID   uint    `gorm:"not null" json:"order_id"`
	ProductID uint    `gorm:"not null" json:"product_id"`
	Quantity  int     `gorm:"not null" json:"quantity"`
	Price     float64 `gorm:"not null" json:"price"` // Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯ Ø¯Ø± Ø²Ù…Ø§Ù† Ø®Ø±ÛŒØ¯
	//Relations
	Product Product `gorm:"foreignKey:ProductID" json:"product,omitempty"`
}

func (Order) TableName() string     { return "orders" }
func (OrderItem) TableName() string { return "order_items" }
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\Product.go ===== 
package Models

import "time"

type Product struct {
	ID          uint       `gorm:"primaryKey" json:"id"`
	Name        string     `gorm:"not null" json:"name"`
	Brand       string     `gorm:"not null" json:"brand"`
	Price       float64    `gorm:"not null" json:"price"` //ØªÙˆÙ…Ø§Ù†
	Description string     `json:"description"`
	Stock       int        `gorm:"not null;default:0" json:"stock"` //Ù…ÙˆØ¬ÙˆØ¯ÛŒ
	IsActive    bool       `gorm:"default:true" json:"is_active"`
	CreateAt    time.Time  `json:"created_at"`
	UpdateAt    time.Time  `json:"updated_at"`
	Deleted_at  *time.Time `json:"deleted_at"`
}

func (Product) TableName() string { return "products" }
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\User.go ===== 
package Models

import "time"

type User struct {
	ID         uint       `json:"id" gorm:"primaryKey"`
	FirstName  string     `json:"first_name" gorm:"not null"`
	LastName   string     `json:"last_name" gorm:"not null"`
	Phone      string     `json:"phone" gorm:"unique;not null"`
	Address    string     `json:"address" gorm:"not null"`
	NationalID string     `json:"national_ID" gorm:"unique;not null"`
	Password   string     `json:"-" gorm:"not null"`
	Role       string     `json:"-" gorm:"not null;default:user"` // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ user
	IsVerified bool       `json:"is_verified" gorm:"default:false"`
	VerifyCode string     `json:"-"  gorm:"size:6"`
	CreateAt   time.Time  `json:"created_at"`
	UpdateAt   time.Time  `json:"updated_at"`
	Deleted_at *time.Time `json:"deleted_at"`
}

func (User) TableName() string { return "users" }
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\Admin\Admin.go ===== 
package Admin

import (
	"errors"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils/Http"
	"gorm.io/gorm"
)

var fillable = []string{
	"first_name", "last_name", "phone", "address", "national_id", "password",
}

type AdminCreateDTO struct {
	FirstName  string
	LastName   string
	Phone      string
	Address    string
	NationalID string
	Password   string
}

type AdminUpdateDTO struct {
	FirstName  string
	LastName   string
	Phone      string
	Address    string
	NationalID string
	Password   string // Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
}

func Paginate(tx *gorm.DB, c *fiber.Ctx) (admins []Models.Admin, meta Http.PaginationMetadata, err error) {
	tx, meta = Http.Paginate(tx, c)
	err = tx.Find(&admins).Error
	return
}

func FindByID(tx *gorm.DB, id uint) (admin Models.Admin, err error) {
	err = tx.Where("deleted_at IS NULL").First(&admin, id).Error
	return
}

func Create(tx *gorm.DB, dto AdminCreateDTO) (admin Models.Admin, err error) {
	admin = Models.Admin{
		FirstName:  dto.FirstName,
		LastName:   dto.LastName,
		Phone:      dto.Phone,
		Address:    dto.Address,
		NationalID: dto.NationalID,
		Password:   dto.Password,
		Role:       "admin",
		IsVerified: false,
		CreateAt:   time.Now(),
		UpdateAt:   time.Now(),
	}
	err = tx.Create(&admin).Error
	return
}

func Update(tx *gorm.DB, id uint, dto AdminUpdateDTO) error {
	updates := map[string]interface{}{
		"first_name":  dto.FirstName,
		"last_name":   dto.LastName,
		"phone":       dto.Phone,
		"address":     dto.Address,
		"national_id": dto.NationalID,
		"updated_at":  time.Now(),
	}
	if dto.Password != "" {
		updates["password"] = dto.Password
	}

	result := tx.Model(&Models.Admin{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Updates(updates)

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("admin not found or already deleted")
	}
	return nil
}

func SoftDelete(tx *gorm.DB, id uint) error {
	result := tx.Model(&Models.Admin{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Update("deleted_at", time.Now())

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("admin not found or already deleted")
	}
	return nil
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\Order\Order.go ===== 
package Order

import (
	"errors"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils/Http"
	"gorm.io/gorm"
)

func Paginate(tx *gorm.DB, c *fiber.Ctx) (orders []Models.Order, meta Http.PaginationMetadata, err error) {
	tx, meta = Http.Paginate(tx, c)
	err = tx.Preload("Items.Product").Find(&orders).Error
	return
}

func FindByID(tx *gorm.DB, id uint) (order Models.Order, err error) {
	err = tx.Where("deleted_at IS NULL").Preload("Items.Product").First(&order, id).Error
	return
}

func UpdateStatus(tx *gorm.DB, id uint, status Models.OrderStatus) error {
	result := tx.Model(&Models.Order{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Update("status", status)

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("order not found or not active")
	}
	return nil
}

func SoftDelete(tx *gorm.DB, id uint) error {
	result := tx.Model(&Models.Order{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Update("deleted_at", time.Now())

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("order not found or already deleted")
	}
	return nil
}

func CreateOrder(tx *gorm.DB, userID uint, items []OrderItemCreateDTO) (order Models.Order, err error) {
	total := 0.0
	var orderItems []Models.OrderItem

	for _, item := range items {
		var product Models.Product
		if err := tx.First(&product, item.ProductID).Error; err != nil {
			return order, err
		}

		itemTotal := product.Price * float64(item.Quantity)
		total += itemTotal

		orderItems = append(orderItems, Models.OrderItem{
			ProductID: item.ProductID,
			Quantity:  item.Quantity,
			Price:     product.Price,
		})
	}

	order = Models.Order{
		UserID:     userID,
		Status:     Models.StatusPending,
		TotalPrice: total,
		Items:      orderItems,
		CreateAt:   time.Now(),
		UpdateAt:   time.Now(),
	}

	err = tx.Create(&order).Error
	return order, err
}

type OrderItemCreateDTO struct {
	ProductID uint `json:"product_id"`
	Quantity  int  `json:"quantity"`
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\Product\Product.go ===== 
// file: internal/Models/Product/product_repository.go
package Product

import (
	"errors"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils/Http"
	"gorm.io/gorm"
)

var fillable = []string{
	"name", "brand", "price", "description", "stock", "is_active",
}

type ProductCreateDTO struct {
	Name        string
	Brand       string
	Price       float64
	Description string
	Stock       int
	IsActive    bool
}

type ProductUpdateDTO struct {
	Name        string
	Brand       string
	Price       float64
	Description string
	Stock       int
	IsActive    bool
}

type PaginationMetadata struct {
	TotalRecords int
	TotalPages   int
	CurrentPage  int
	PerPage      int
}

func Paginate(tx *gorm.DB, c *fiber.Ctx) (products []Models.Product, meta Http.PaginationMetadata, err error) {
	tx, meta = Http.Paginate(tx, c)
	err = tx.Find(&products).Error
	return
}

func FindByID(tx *gorm.DB, id uint) (product Models.Product, err error) {
	err = tx.Where("deleted_at IS NULL").First(&product, id).Error
	return
}

func Create(tx *gorm.DB, dto ProductCreateDTO) (product Models.Product, err error) {
	product = Models.Product{
		Name:        dto.Name,
		Brand:       dto.Brand,
		Price:       dto.Price,
		Description: dto.Description,
		Stock:       dto.Stock,
		IsActive:    dto.IsActive,
		CreateAt:    time.Now(),
		UpdateAt:    time.Now(),
	}
	err = tx.Create(&product).Error
	return
}

func Update(tx *gorm.DB, id uint, dto ProductUpdateDTO) error {
	updates := map[string]interface{}{
		"name":        dto.Name,
		"brand":       dto.Brand,
		"price":       dto.Price,
		"description": dto.Description,
		"stock":       dto.Stock,
		"is_active":   dto.IsActive,
		"updated_at":  time.Now(),
	}

	result := tx.Model(&Models.Product{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Updates(updates)

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("product not found or already deleted")
	}
	return nil
}

func SoftDelete(tx *gorm.DB, id uint) error {
	result := tx.Model(&Models.Product{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Update("deleted_at", time.Now())

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("product not found or already deleted")
	}
	return nil
}

func DecreaseStock(tx *gorm.DB, productID uint, quantity int) error {
	var product Models.Product
	if err := tx.First(&product, productID).Error; err != nil {
		return err
	}

	if product.Stock < quantity {
		return errors.New("insufficient stock")
	}

	product.Stock -= quantity
	return tx.Save(&product).Error
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Models\User\User.go ===== 
// file: internal/Models/User/user_repository.go
package User

import (
	"errors"
	"time"

	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Utils/Http"
	"gorm.io/gorm"
)

// ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ù†ÙˆØ´ØªÙ† Ø§Ø² Ø¨ÛŒØ±ÙˆÙ†
var fillable = []string{
	"first_name", "last_name", "phone", "address", "national_id", "password",
}

/* ---------- DTOÙ‡Ø§ (type-safe) ---------- */
type UserCreateDTO struct {
	FirstName  string
	LastName   string
	Phone      string
	Address    string
	NationalID string
	Password   string
}

type UserUpdateDTO struct {
	FirstName  string
	LastName   string
	Phone      string
	Address    string
	NationalID string
	Password   string // Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
}

type PaginationMetadata struct {
	TotalRecords int
	TotalPages   int
	CurrentPage  int
	PerPage      int
}

/* ---------- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ (Ø¨Ø§ Ø®ÙˆØ§Ù†Ø¯Ù† page & per_page Ø§Ø² Ú©ÙˆØ¦Ø±ÛŒ) ---------- */
func Paginate(tx *gorm.DB, c *fiber.Ctx) (users []Models.User, meta Http.PaginationMetadata, err error) {
	tx, meta = Http.Paginate(tx, c)
	err = tx.Find(&users).Error
	return
}

/* ---------- Ø®ÙˆØ§Ù†Ø¯Ù† ÛŒÚ© Ø±Ú©ÙˆØ±Ø¯ (Ø¨Ø¯ÙˆÙ† RAW SQL) ---------- */
func FindByID(tx *gorm.DB, id uint) (user Models.User, err error) {
	err = tx.Where("deleted_at IS NULL").First(&user, id).Error
	return
}

/* ---------- Ø¯Ø±Ø¬ (Ø¨Ø§ DTO Ùˆ Ø¨Ø¯ÙˆÙ† RAW SQL) ---------- */
func Create(tx *gorm.DB, dto UserCreateDTO) (user Models.User, err error) {
	user = Models.User{
		FirstName:  dto.FirstName,
		LastName:   dto.LastName,
		Phone:      dto.Phone,
		Address:    dto.Address,
		NationalID: dto.NationalID,
		Password:   dto.Password,
		Role:       "user",
		IsVerified: false,
		CreateAt:   time.Now(),
		UpdateAt:   time.Now(),
	}
	err = tx.Create(&user).Error
	return
}

/* ---------- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ (Ø¨Ø§ DTO Ùˆ Ø¨Ø¯ÙˆÙ† RAW SQL) ---------- */
func Update(tx *gorm.DB, id uint, dto UserUpdateDTO) error {
	updates := map[string]interface{}{
		"first_name":  dto.FirstName,
		"last_name":   dto.LastName,
		"phone":       dto.Phone,
		"address":     dto.Address,
		"national_id": dto.NationalID,
		"updated_at":  time.Now(),
	}
	if dto.Password != "" {
		updates["password"] = dto.Password
	}

	result := tx.Model(&Models.User{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Updates(updates)

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("user not found or already deleted")
	}
	return nil
}

/* ---------- Ø­Ø°Ù Ù…Ù†Ø·Ù‚ÛŒ (Ø¨Ø¯ÙˆÙ† RAW SQL) ---------- */
func SoftDelete(tx *gorm.DB, id uint) error {
	result := tx.Model(&Models.User{}).
		Where("id = ? AND deleted_at IS NULL", id).
		Update("deleted_at", time.Now())

	if result.Error != nil {
		return result.Error
	}
	if result.RowsAffected == 0 {
		return errors.New("user not found or already deleted")
	}
	return nil
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Providers\ErrorProvider.go ===== 
package Providers

func ErrorProvider(err error) string {
	message := err.Error()

	return message
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Resources\AdminResource\AdminResource.go ===== 
package AdminResource

import (
	"time"

	"github.com/vahidlotfi71/online-store-api/Models"
)

type AdminDTO struct {
	ID         uint      `json:"id"`
	FirstName  string    `json:"first_name"`
	LastName   string    `json:"last_name"`
	Phone      string    `json:"phone"`
	Address    string    `json:"address"`
	NationalID string    `json:"national_ID"`
	IsVerified bool      `json:"is_verified"`
	CreatedAt  time.Time `json:"created_at"`
	UpdatedAt  time.Time `json:"updated_at"`
}

func Single(a Models.Admin) AdminDTO {
	return AdminDTO{
		ID:         a.ID,
		FirstName:  a.FirstName,
		LastName:   a.LastName,
		Phone:      a.Phone,
		Address:    a.Address,
		NationalID: a.NationalID,
		IsVerified: a.IsVerified,
		CreatedAt:  a.CreateAt,
		UpdatedAt:  a.UpdateAt,
	}
}

func Collection(admins []Models.Admin) []AdminDTO {
	out := make([]AdminDTO, 0, len(admins))
	for _, a := range admins {
		out = append(out, Single(a))
	}
	return out
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Resources\OrderResource\OrderResource.go ===== 
// file: Resources/OrderResource/OrderResource.go
package OrderResource

import (
	"time"

	"github.com/vahidlotfi71/online-store-api/Models"
)

type OrderItemDTO struct {
	ID        uint    `json:"id"`
	ProductID uint    `json:"product_id"`
	Quantity  int     `json:"quantity"`
	Price     float64 `json:"price"`
}

type OrderDTO struct {
	ID         uint           `json:"id"`
	UserID     uint           `json:"user_id"`
	Status     string         `json:"status"`
	TotalPrice float64        `json:"total_price"`
	Items      []OrderItemDTO `json:"items"`
	CreatedAt  time.Time      `json:"created_at"`
	UpdatedAt  time.Time      `json:"updated_at"`
}

func Single(o Models.Order) OrderDTO {
	items := make([]OrderItemDTO, len(o.Items))
	for i, item := range o.Items {
		items[i] = OrderItemDTO{
			ID:        item.ID,
			ProductID: item.ProductID,
			Quantity:  item.Quantity,
			Price:     item.Price,
		}
	}
	return OrderDTO{
		ID:         o.ID,
		UserID:     o.UserID,
		Status:     string(o.Status),
		TotalPrice: o.TotalPrice,
		Items:      items,
		CreatedAt:  o.CreateAt,
		UpdatedAt:  o.UpdateAt,
	}
}

func Collection(orders []Models.Order) []OrderDTO {
	out := make([]OrderDTO, 0, len(orders))
	for _, o := range orders {
		out = append(out, Single(o))
	}
	return out
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Resources\ProductResource\ProductResource.go ===== 
// file: Resources/ProductResource/ProductResource.go
package ProductResource

import (
	"time"

	"github.com/vahidlotfi71/online-store-api/Models"
)

type ProductDTO struct {
	ID          uint      `json:"id"`
	Name        string    `json:"name"`
	Brand       string    `json:"brand"`
	Price       float64   `json:"price"`
	Description string    `json:"description"`
	Stock       int       `json:"stock"`
	IsActive    bool      `json:"is_active"`
	CreatedAt   time.Time `json:"created_at"`
	UpdatedAt   time.Time `json:"updated_at"`
}

func Single(p Models.Product) ProductDTO {
	return ProductDTO{
		ID:          p.ID,
		Name:        p.Name,
		Brand:       p.Brand,
		Price:       p.Price,
		Description: p.Description,
		Stock:       p.Stock,
		IsActive:    p.IsActive,
		CreatedAt:   p.CreateAt,
		UpdatedAt:   p.UpdateAt,
	}
}

func Collection(products []Models.Product) []ProductDTO {
	out := make([]ProductDTO, 0, len(products))
	for _, p := range products {
		out = append(out, Single(p))
	}
	return out
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Resources\UserResource\UserResource.go ===== 
// file: Resources/UserResource/user_resource.go
package UserResource

import (
	"time"

	"github.com/vahidlotfi71/online-store-api/Models"
)

type User struct {
	ID         uint      `json:"id"`
	FirstName  string    `json:"first_name"`
	LastName   string    `json:"last_name"`
	Phone      string    `json:"phone"`
	Address    string    `json:"address"`
	NationalID string    `json:"national_ID"`
	IsVerified bool      `json:"is_verified"`
	CreatedAt  time.Time `json:"created_at"`
	UpdatedAt  time.Time `json:"updated_at"`
}

func Single(u Models.User) User {
	return User{
		ID:         u.ID,
		FirstName:  u.FirstName,
		LastName:   u.LastName,
		Phone:      u.Phone,
		Address:    u.Address,
		NationalID: u.NationalID,
		IsVerified: u.IsVerified,
		CreatedAt:  u.CreateAt,
		UpdatedAt:  u.UpdateAt,
	}
}

func Collection(users []Models.User) []User {
	out := make([]User, 0, len(users))
	for _, u := range users {
		out = append(out, Single(u))
	}
	return out
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Routes\Routes.go ===== 
package Routes

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Controllers/AuthController"
	"github.com/vahidlotfi71/online-store-api/Controllers/OrderController"
	"github.com/vahidlotfi71/online-store-api/Controllers/ProductController"
	"github.com/vahidlotfi71/online-store-api/Controllers/UserController"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Models"
	"github.com/vahidlotfi71/online-store-api/Resources/UserResource"
	"github.com/vahidlotfi71/online-store-api/Validations/Admin/ProductValidation"
	"github.com/vahidlotfi71/online-store-api/Validations/Admin/UserValidation"
	"github.com/vahidlotfi71/online-store-api/Validations/Auth"
)

func SetupRoutes(app *fiber.App) {

	// ---------- PUBLIC AUTH ----------
	app.Post("/admin/login", Auth.AdminLogin(), AuthController.AdminLogin)
	app.Post("/login", Auth.Login(), AuthController.Login)
	app.Post("/register", Auth.Register(), AuthController.Register)
	app.Post("/logout", AuthController.AdminLogout)

	// ---------- ADMIN GROUP ----------
	admin := app.Group("/admin", Middlewares.AdminAuthMiddleware)

	// dashboard
	admin.Get("/dashboard", func(c *fiber.Ctx) error {
		return c.JSON(fiber.Map{"message": "Admin Dashboard"})
	})

	// ---------- ADMIN.USER ----------
	adminUser := admin.Group("/user")
	adminUser.Get("/", UserController.Index).Name("admin.user.index")
	adminUser.Get("/show/:id", UserController.Show).Name("admin.user.show")
	adminUser.Post("/store", UserValidation.Store(), UserController.Store).Name("admin.user.store")
	adminUser.Post("/update/:id", UserValidation.Update(), UserController.Update).Name("admin.user.update")
	adminUser.Post("/delete/:id", UserController.Delete).Name("admin.user.delete")
	adminUser.Get("/restore/:id", UserController.Restore).Name("admin.user.restore")
	adminUser.Get("/trash", UserController.Trash).Name("admin.user.trash")
	adminUser.Post("/clear-trash", UserController.ClearTrash).Name("admin.user.clear-trash")

	// ---------- ADMIN.PRODUCT ----------
	adminProduct := admin.Group("/product")
	adminProduct.Get("/", ProductController.Index).Name("admin.product.index")
	adminProduct.Get("/show/:id", ProductController.Show).Name("admin.product.show")
	adminProduct.Post("/store", ProductValidation.CreateProduct(), ProductController.Store).Name("admin.product.store")
	adminProduct.Post("/update/:id", ProductValidation.UpdateProduct(), ProductController.Update).Name("admin.product.update")
	adminProduct.Post("/delete/:id", ProductController.Delete).Name("admin.product.delete")
	adminProduct.Get("/restore/:id", ProductController.Restore).Name("admin.product.restore")
	adminProduct.Get("/trash", ProductController.Trash).Name("admin.product.trash")
	adminProduct.Post("/clear-trash", ProductController.ClearTrash).Name("admin.product.clear-trash")

	// ---------- ADMIN.ORDER ----------
	adminOrder := admin.Group("/order")
	adminOrder.Get("/", OrderController.Index).Name("admin.order.index")
	adminOrder.Get("/show/:id", OrderController.Show).Name("admin.order.show")
	adminOrder.Post("/update/:id", OrderController.Update).Name("admin.order.update")
	adminOrder.Get("/trash", OrderController.Trash).Name("admin.order.trash")

	// ---------- USER (AUTHENTICATED) ----------
	user := app.Group("/user", Middlewares.UserAuthMiddleware)
	user.Get("/profile", func(c *fiber.Ctx) error {
		user := c.Locals("user").(Models.User)
		return c.JSON(fiber.Map{"data": UserResource.Single(user)})
	})
	user.Post("/profile/update", UserValidation.Update(), UserController.Update)
	user.Get("/orders", OrderController.Index)
	// user.Post("/orders", OrderController.Store) // Ø¨Ø¹Ø¯Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯

	// ---------- PUBLIC PRODUCT ----------
	app.Get("/products", ProductController.Index)
	app.Get("/products/:id", ProductController.Show)

	// ---------- 404 HANDLER ----------
	app.Use("*", func(c *fiber.Ctx) error {
		return c.Status(404).JSON(fiber.Map{"message": "Route Not Found"})
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\LengthBetween.go ===== 
package Rules

import (
	"fmt"

	"github.com/gofiber/fiber/v2"
)

func LengthBetween(min, max uint) ValidationRule {
	return func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
		value := c.FormValue(field_name)

		message = fmt.Sprintf("The %s field must be between %d  and %d characters", field_name, min, max)

		if len(value) > int(max) || len(value) < int(min) {
			return false, message, nil, nil
		}
		return true, "", nil, nil
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\MaxLength.go ===== 
package Rules

import (
	"fmt"

	"github.com/gofiber/fiber/v2"
)

func MaxLength(max uint) ValidationRule {
	return func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
		value := c.FormValue(field_name)

		message = fmt.Sprintf("The %s field must not exceed %d characters", field_name, max)

		if len(value) > int(max) {
			return false, message, nil, nil
		}
		return true, "", nil, nil
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\MinLength.go ===== 
package Rules

import (
	"fmt"

	"github.com/gofiber/fiber/v2"
)

func MinLength(min uint) ValidationRule {
	return func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
		value := c.FormValue(field_name)

		message = fmt.Sprintf("The %s field must be at least %d characters long", field_name, min)

		if len(value) < int(min) {
			return false, message, nil, nil
		}
		return true, "", nil, nil
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\NationalID.go ===== 
package Rules

import (
	"fmt"
	"regexp"
	"strconv"

	"github.com/gofiber/fiber/v2"
)

func NationalID() ValidationRule {
	return func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
		value := c.FormValue(field_name)

		// Ø§Ú¯Ø± ÙÛŒÙ„Ø¯ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´ÙˆØ¯ (Ø¨Ø§ Required Ú†Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯)
		if value == "" {
			return true, "", nil, nil
		}

		// Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ù…Øª Û±Û° Ø±Ù‚Ù…ÛŒ
		matched, _ := regexp.MatchString(`^\d{10}$`, value)
		if !matched {
			message := fmt.Sprintf("The %s field must be exactly 10 digits", field_name)
			return false, message, nil, nil
		}

		// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ù‚Ù… Ú©Ù†ØªØ±Ù„ (checksum)
		sum := 0
		for i := 0; i < 9; i++ {
			d, _ := strconv.Atoi(string(value[i]))
			sum += d * (10 - i)
		}

		remainder := sum % 11
		checkDigit, _ := strconv.Atoi(string(value[9]))

		// Ø¨Ø±Ø±Ø³ÛŒ ØµØ­Øª Ø±Ù‚Ù… Ú©Ù†ØªØ±Ù„ÛŒ
		if (remainder < 2 && checkDigit != remainder) ||
			(remainder >= 2 && checkDigit != (11-remainder)) {
			message := fmt.Sprintf("The %s field is not a valid national ID", field_name)
			return false, message, nil, nil
		}

		// Ø¯Ø± ØµÙˆØ±Øª Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù†
		return true, "", nil, nil
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\Numeric.go ===== 
package Rules

import (
	"fmt"
	"strconv"

	"github.com/gofiber/fiber/v2"
)

func Numeric() ValidationRule {
	return func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
		value := c.FormValue(field_name)

		if value == "" {
			return true, "", nil, nil
		}

		if _, err := strconv.Atoi(value); err != nil {
			message := fmt.Sprintf("The %s field must be a number", field_name)
			return false, message, nil, nil
		}
		return true, "", nil, nil
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\PhoneNumber.go ===== 
package Rules

import (
	"fmt"
	"regexp"
	"strings"

	"github.com/gofiber/fiber/v2"
)

func PhoneNumber() ValidationRule {
	return func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
		value := c.FormValue(field_name)

		if value == "" {
			return true, "", nil, nil
		}

		cleaned := cleanPhoneNumber(value)

		// Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø§ÛŒØ±Ø§Ù†
		patterns := []string{
			`^09[0-9]{9}$`,    // 09123456789
			`^9[0-9]{9}$`,     // 9123456789 (Ø¨Ø¯ÙˆÙ† ØµÙØ±)
			`^\+989[0-9]{9}$`, // +989123456789
			`^00989[0-9]{9}$`, // 00989123456789
		}

		for _, pattern := range patterns {
			matched, _ := regexp.MatchString(pattern, cleaned)
			if matched {
				return true, "", nil, nil
			}
		}

		message = fmt.Sprintf("Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. ÙØ±Ù…Øª ØµØ­ÛŒØ­: 09123456789")
		return false, message, nil, nil
	}
}

// ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
func cleanPhoneNumber(phone string) string {
	// Ø­Ø°Ù ÙØ§ØµÙ„Ù‡ØŒ Ø®Ø· ØªÛŒØ±Ù‡ Ùˆ Ù¾ÛŒØ´ Ø´Ù…Ø§Ø±Ù‡ +98
	cleaned := strings.ReplaceAll(phone, " ", "")
	cleaned = strings.ReplaceAll(cleaned, "-", "")
	cleaned = strings.ReplaceAll(cleaned, "+", "")
	cleaned = strings.ReplaceAll(cleaned, "(", "")
	cleaned = strings.ReplaceAll(cleaned, ")", "")

	// ØªØ¨Ø¯ÛŒÙ„ Ù¾ÛŒØ´ Ø´Ù…Ø§Ø±Ù‡ 989 Ø¨Ù‡ 09
	if strings.HasPrefix(cleaned, "989") && len(cleaned) == 11 {
		cleaned = "09" + cleaned[3:]
	}

	// ØªØ¨Ø¯ÛŒÙ„ Ù¾ÛŒØ´ Ø´Ù…Ø§Ø±Ù‡ Ø¨Ù‡ 09
	if strings.HasPrefix(cleaned, "989") && len(cleaned) == 12 {
		cleaned = "09" + cleaned[3:]
	}

	return cleaned
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\Required.go ===== 
package Rules

import (
	"fmt"

	"github.com/gofiber/fiber/v2"
)

func Required(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error) {
	form, err := c.MultipartForm()
	if err != nil {
		return false, "", nil, err
	}

	value := form.Value[field_name]
	file := form.File[field_name]

	message = fmt.Sprintf("The %s field is required", field_name)

	if (value == nil || len(value) == 0 || value[0] == "") && (file == nil || len(file) == 0) {
		return false, message, nil, nil
	}

	return true, "", nil, nil
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Rules\Rules.go ===== 
package Rules

import "github.com/gofiber/fiber/v2"

type ValidationRule func(c *fiber.Ctx, field_name string) (passed bool, message string, flags *Flags, err error)

type FieldRules struct {
	FieldName string
	Rules     []ValidationRule
}

type Flags struct {
	IsNull bool
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Utils\Password.go ===== 
package Utils

import "golang.org/x/crypto/bcrypt"

func GenerateHashPassword(password string) (string, error) {
	hash, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)

	if err != nil {
		return "", err
	}
	return string(hash), nil
}

func VerifyPassword(password, hashedPassword string) error {
	err := bcrypt.CompareHashAndPassword([]byte(hashedPassword), []byte(password))

	return err
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Utils\Token.go ===== 
package Utils

import (
	"fmt"
	"strconv"
	"time"

	"github.com/golang-jwt/jwt/v5"
	"github.com/vahidlotfi71/online-store-api/Config"
)

// JWTClaims Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø±Ø§ÛŒ User Ùˆ Admin
type JWTClaims struct {
	ID    uint   `json:"id"`   // ID Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ Ø§Ø¯Ù…ÛŒÙ†
	Role  string `json:"role"` // "user" ÛŒØ§ "admin"
	Name  string `json:"name"`
	Phone string `json:"phone"`
	jwt.RegisteredClaims
}

// Ø§ÛŒØ¬Ø§Ø¯ ØªÙˆÚ©Ù† Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø±Ø§ÛŒ User ÛŒØ§ Admin
func CreateToken(id uint, role, name, phone string, rememberMe bool) (string, time.Time, error) {
	months := 1
	if rememberMe {
		months = 6
	}

	expireTime := time.Now().AddDate(0, months, 0)

	claims := JWTClaims{
		ID:    id,
		Role:  role,
		Name:  name,
		Phone: phone,
		RegisteredClaims: jwt.RegisteredClaims{
			ExpiresAt: jwt.NewNumericDate(expireTime),
			IssuedAt:  jwt.NewNumericDate(time.Now()),
			Issuer:    "online-store-api",
			Subject:   strconv.FormatUint(uint64(id), 10),
		},
	}

	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
	tokenString, err := token.SignedString([]byte(Config.JWT_SECRET))
	if err != nil {
		return "", time.Time{}, err
	}

	return tokenString, expireTime, nil
}

// Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆÚ©Ù†
func VerifyToken(tokenString string) (*JWTClaims, error) {
	token, err := jwt.ParseWithClaims(tokenString, &JWTClaims{}, func(token *jwt.Token) (any, error) {
		if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
			return nil, fmt.Errorf("unexpected signing method: %v", token.Header["alg"])
		}
		return []byte(Config.JWT_SECRET), nil
	})
	if err != nil {
		return nil, fmt.Errorf("invalid token: %v", err)
	}

	claims, ok := token.Claims.(*JWTClaims)
	if !ok || !token.Valid {
		return nil, fmt.Errorf("invalid token")
	}

	// Ø¨Ø±Ø±Ø³ÛŒ Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§
	if claims.ExpiresAt.Time.Before(time.Now()) {
		return nil, fmt.Errorf("expired token")
	}

	return claims, nil
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Utils\Constants\Constants.go ===== 
package Constants

import (
	"os"
	"path/filepath"
)

// GetBaseDir returns the working directory of the running binary
func GetBaseDir() string {
	dir, err := os.Getwd()
	if err != nil {
		return ""
	}
	return dir
}

// --- core paths --------------------------------------------------
var BASE_DIR string = GetBaseDir()
var PUBLIC_DIR string = filepath.Join(BASE_DIR, "public")
var UPLOADS_PATH string = filepath.Join(PUBLIC_DIR, "uploads")

// --- application meta -------------------------------------------
var VERSION string = "0.0.5"
 
 
===== FILE: D:\copyAllinOne\online-store-api\Utils\Http\Pagination.go ===== 
// file: Utils/Http/pagination.go
package Http

import (
	"math"
	"strconv"

	"github.com/gofiber/fiber/v2"
	"gorm.io/gorm"
)

type PaginationMetadata struct {
	TotalPages   int  `json:"totalPages"`
	PreviousPage *int `json:"previousPage"`
	NextPage     *int `json:"nextPage"`
	Offset       int  `json:"offset"`
	LimitPerPage int  `json:"limitPerPage"`
	CurrentPage  int  `json:"currentPage"`
}

// Paginate ØªØ±Ø§Ú©Ù†Ø´ ÙˆØ±ÙˆØ¯ÛŒ Ø±Ø§ ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù…ØªØ§Ø¯ÛŒØªØ§ + Ú©ÙˆØ¦Ø±ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
func Paginate(tx *gorm.DB, c *fiber.Ctx) (*gorm.DB, PaginationMetadata) {
	page, perPage := getPageAndPerPage(c)

	var total int64
	tx.Count(&total)

	meta := calcMetadata(page, perPage, total)
	return tx.Limit(meta.LimitPerPage).Offset(meta.Offset), meta
}

/* ---------- Ø®ÙˆØ§Ù†Ø¯Ù† Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ + Ø³Ù‚Ù Ø§Ù…Ù† ---------- */
const maxPerPage = 100
const defaultLimit = 15

func getPageAndPerPage(c *fiber.Ctx) (page, perPage int) {
	if p, err := strconv.Atoi(c.Query("page", "1")); err == nil && p > 0 {
		page = p
	} else {
		page = 1
	}

	if pp, err := strconv.Atoi(c.Query("per_page", strconv.Itoa(defaultLimit))); err == nil {
		if pp > maxPerPage {
			pp = maxPerPage
		}
		if pp < 1 {
			pp = defaultLimit
		}
		perPage = pp
	} else {
		perPage = defaultLimit
	}
	return
}

/* ---------- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ØªØ§Ø¯ÛŒØªØ§ ---------- */
func calcMetadata(page, perPage int, total int64) PaginationMetadata {
	totalPages := int(math.Ceil(float64(total) / float64(perPage)))
	current := page
	if current > totalPages {
		current = totalPages
	}
	var prev *int
	if current-1 > 0 {
		temp := current - 1
		prev = &temp
	}
	var next *int
	if current+1 <= totalPages {
		temp := current + 1
		next = &temp
	}
	offset := (current - 1) * perPage
	if offset < 0 {
		offset = 0
	}
	return PaginationMetadata{
		TotalPages:   totalPages,
		PreviousPage: prev,
		NextPage:     next,
		Offset:       offset,
		LimitPerPage: perPage,
		CurrentPage:  current,
	}
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Validations\Admin\ProductValidation\ProductValidation.go ===== 
package ProductValidation

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func CreateProduct() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(2, 100)},
		},
		{
			FieldName: "brand",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(2, 100)},
		},
		{
			FieldName: "price",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.Numeric()},
		},
		{
			FieldName: "description",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(10, 255)},
		},
		{
			FieldName: "stock",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.Numeric()},
		},
	})
}

func UpdateProduct() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "name",
			Rules:     []Rules.ValidationRule{Rules.LengthBetween(2, 100)},
		},
		{
			FieldName: "brand",
			Rules:     []Rules.ValidationRule{Rules.LengthBetween(2, 100)},
		},
		{
			FieldName: "price",
			Rules:     []Rules.ValidationRule{Rules.Numeric()},
		},
		{
			FieldName: "description",
			Rules:     []Rules.ValidationRule{Rules.LengthBetween(10, 255)},
		},
		{
			FieldName: "stock",
			Rules:     []Rules.ValidationRule{Rules.Numeric()},
		},
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Validations\Admin\UserValidation\UserValidation.go ===== 
package UserValidation

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func Store() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "first_name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(2, 255)},
		},
		{
			FieldName: "last_name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(2, 255)},
		},
		{
			FieldName: "phone",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.PhoneNumber()},
		},
		{
			FieldName: "address",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(10, 255)},
		},
		{
			FieldName: "national_ID",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.NationalID()},
		},
		{
			FieldName: "password",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(8, 16)},
		},
	})
}

func Update() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "first_name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(2, 255)},
		},
		{
			FieldName: "last_name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(2, 255)},
		},
		{
			FieldName: "phone",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.PhoneNumber()},
		},
		{
			FieldName: "password",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(8, 16)},
		},
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Validations\Auth\AdminLoginValidation.go ===== 
package Auth

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func AdminLogin() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "phone",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.PhoneNumber()},
		},
		{
			FieldName: "password",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.MinLength(8)},
		},
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Validations\Auth\LoginValidation.go ===== 
package Auth

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func Login() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "phone",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.PhoneNumber()},
		},
		{
			FieldName: "password",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.MinLength(8)},
		},
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Validations\Auth\RegisterValidation.go ===== 
package Auth

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func Register() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "first_name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(3, 255)},
		},
		{
			FieldName: "last_name",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(3, 255)},
		},
		{
			FieldName: "phone",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.PhoneNumber()},
		},
		{
			FieldName: "password",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(8, 16)},
		},
		{
			FieldName: "address",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.LengthBetween(50, 300)},
		},
		{
			FieldName: "role",
			Rules:     []Rules.ValidationRule{Rules.Required},
		},
	})
}
 
 
===== FILE: D:\copyAllinOne\online-store-api\Validations\Order\OrderValidation.go ===== 
package OrderValidation

import (
	"github.com/gofiber/fiber/v2"
	"github.com/vahidlotfi71/online-store-api/Middlewares"
	"github.com/vahidlotfi71/online-store-api/Rules"
)

func CreateOrderValidation() func(c *fiber.Ctx) error {
	return Middlewares.ValidationMiddleware([]Rules.FieldRules{
		{
			FieldName: "user_id",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.Numeric()},
		},
		{
			FieldName: "total_price",
			Rules:     []Rules.ValidationRule{Rules.Required, Rules.Numeric()},
		},
		{
			FieldName: "items",
			Rules:     []Rules.ValidationRule{Rules.Required},
		},
	})
}
 
 
